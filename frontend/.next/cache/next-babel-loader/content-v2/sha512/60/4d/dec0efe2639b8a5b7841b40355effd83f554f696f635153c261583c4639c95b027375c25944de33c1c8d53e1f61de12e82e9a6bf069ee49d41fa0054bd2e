{"ast":null,"code":"import 'dotenv/config';\nimport { ApolloClient, ApolloLink, InMemoryCache } from '@apollo/client';\nimport { onError } from '@apollo/link-error';\nimport { getDataFromTree } from '@apollo/client/react/ssr';\nimport { createUploadLink } from 'apollo-upload-client';\nimport withApollo from 'next-with-apollo';\n\nfunction createClient({\n  headers,\n  initialState\n}) {\n  return new ApolloClient({\n    link: ApolloLink.from([onError(({\n      graphQLErrors,\n      networkError\n    }) => {\n      if (graphQLErrors) graphQLErrors.forEach(({\n        message,\n        locations,\n        path\n      }) => console.log(`[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`));\n      if (networkError) console.log(`[Network error]: ${networkError}. Backend is unreachable. Is it running?`);\n    }), // this uses apollo-link-http under the hood, so all the options here come from that package\n    createUploadLink({\n      uri: true ? process.env.ENDPOINT : process.env.PROD_ENDPOINT,\n      fetchOptions: {\n        credentials: 'include'\n      },\n      // pass the headers along from this request. This enables SSR with logged in state\n      headers\n    })]),\n    cache: new InMemoryCache({\n      typePolicies: {\n        Query: {\n          fields: {// TODO: We will add this together!\n            // allProducts: paginationField(),\n          }\n        }\n      }\n    }).restore(initialState || {})\n  });\n}\n\nexport default withApollo(createClient, {\n  getDataFromTree\n});","map":{"version":3,"sources":["/home/lkowalski/private projects/advanced-react-course/frontend/lib/withData.js"],"names":["ApolloClient","ApolloLink","InMemoryCache","onError","getDataFromTree","createUploadLink","withApollo","createClient","headers","initialState","link","from","graphQLErrors","networkError","forEach","message","locations","path","console","log","uri","process","env","ENDPOINT","PROD_ENDPOINT","fetchOptions","credentials","cache","typePolicies","Query","fields","restore"],"mappings":"AAAA,OAAO,eAAP;AACA,SAASA,YAAT,EAAuBC,UAAvB,EAAmCC,aAAnC,QAAwD,gBAAxD;AACA,SAASC,OAAT,QAAwB,oBAAxB;AACA,SAASC,eAAT,QAAgC,0BAAhC;AACA,SAASC,gBAAT,QAAiC,sBAAjC;AACA,OAAOC,UAAP,MAAuB,kBAAvB;;AAEA,SAASC,YAAT,CAAsB;AAAEC,EAAAA,OAAF;AAAWC,EAAAA;AAAX,CAAtB,EAAiD;AAC/C,SAAO,IAAIT,YAAJ,CAAiB;AACtBU,IAAAA,IAAI,EAAET,UAAU,CAACU,IAAX,CAAgB,CACpBR,OAAO,CAAC,CAAC;AAAES,MAAAA,aAAF;AAAiBC,MAAAA;AAAjB,KAAD,KAAqC;AAC3C,UAAID,aAAJ,EACEA,aAAa,CAACE,OAAd,CAAsB,CAAC;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,SAAX;AAAsBC,QAAAA;AAAtB,OAAD,KACpBC,OAAO,CAACC,GAAR,CACG,6BAA4BJ,OAAQ,eAAcC,SAAU,WAAUC,IAAK,EAD9E,CADF;AAKF,UAAIJ,YAAJ,EACEK,OAAO,CAACC,GAAR,CACG,oBAAmBN,YAAa,0CADnC;AAGH,KAXM,CADa,EAapB;AACAR,IAAAA,gBAAgB,CAAC;AACfe,MAAAA,GAAG,EACD,OACIC,OAAO,CAACC,GAAR,CAAYC,QADhB,GAEIF,OAAO,CAACC,GAAR,CAAYE,aAJH;AAKfC,MAAAA,YAAY,EAAE;AACZC,QAAAA,WAAW,EAAE;AADD,OALC;AAQf;AACAlB,MAAAA;AATe,KAAD,CAdI,CAAhB,CADgB;AA2BtBmB,IAAAA,KAAK,EAAE,IAAIzB,aAAJ,CAAkB;AACvB0B,MAAAA,YAAY,EAAE;AACZC,QAAAA,KAAK,EAAE;AACLC,UAAAA,MAAM,EAAE,CACN;AACA;AAFM;AADH;AADK;AADS,KAAlB,EASJC,OATI,CASItB,YAAY,IAAI,EATpB;AA3Be,GAAjB,CAAP;AAsCD;;AAED,eAAeH,UAAU,CAACC,YAAD,EAAe;AAAEH,EAAAA;AAAF,CAAf,CAAzB","sourcesContent":["import 'dotenv/config';\nimport { ApolloClient, ApolloLink, InMemoryCache } from '@apollo/client';\nimport { onError } from '@apollo/link-error';\nimport { getDataFromTree } from '@apollo/client/react/ssr';\nimport { createUploadLink } from 'apollo-upload-client';\nimport withApollo from 'next-with-apollo';\n\nfunction createClient({ headers, initialState }) {\n  return new ApolloClient({\n    link: ApolloLink.from([\n      onError(({ graphQLErrors, networkError }) => {\n        if (graphQLErrors)\n          graphQLErrors.forEach(({ message, locations, path }) =>\n            console.log(\n              `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`\n            )\n          );\n        if (networkError)\n          console.log(\n            `[Network error]: ${networkError}. Backend is unreachable. Is it running?`\n          );\n      }),\n      // this uses apollo-link-http under the hood, so all the options here come from that package\n      createUploadLink({\n        uri:\n          process.env.NODE_ENV === 'development'\n            ? process.env.ENDPOINT\n            : process.env.PROD_ENDPOINT,\n        fetchOptions: {\n          credentials: 'include',\n        },\n        // pass the headers along from this request. This enables SSR with logged in state\n        headers,\n      }),\n    ]),\n    cache: new InMemoryCache({\n      typePolicies: {\n        Query: {\n          fields: {\n            // TODO: We will add this together!\n            // allProducts: paginationField(),\n          },\n        },\n      },\n    }).restore(initialState || {}),\n  });\n}\n\nexport default withApollo(createClient, { getDataFromTree });\n"]},"metadata":{},"sourceType":"module"}